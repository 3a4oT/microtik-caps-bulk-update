# CAPsMAN Bulk Upgrade (ac + ax, RouterOS ‚â• 7.16) ‚Äî README (UA)

–¶–µ–π —Å–∫—Ä–∏–ø—Ç –æ–Ω–æ–≤–ª—é—î **–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä** MikroTik (CAPsMAN) —Ç–∞ **CAP-–ø—Ä–∏—Å—Ç—Ä–æ—ó** –¥–æ **–æ—Å—Ç–∞–Ω–Ω—å–æ—ó** –≤–µ—Ä—Å—ñ—ó RouterOS –Ω–∞ **–ø–æ—Ç–æ—á–Ω–æ–º—É** –∫–∞–Ω–∞–ª—ñ –æ–Ω–æ–≤–ª–µ–Ω—å –æ–¥–Ω—ñ—î—é –∫–æ–º–∞–Ω–¥–æ—é. –ü—ñ–¥—Ç—Ä–∏–º—É—î –∑–º—ñ—à–∞–Ω–µ –æ—Ç–æ—á–µ–Ω–Ω—è **ac** (ARM, legacy `/caps-man`) —ñ **ax** (ARM64, –Ω–æ–≤–∏–π `/interface wifi capsman`).  
–°–∫—Ä–∏–ø—Ç —Å–ø–æ—á–∞—Ç–∫—É **–ø–µ—Ä–µ–≤—ñ—Ä—è—î –≤–µ—Ä—Å—ñ—ó**, –ø–æ—Ç—ñ–º ‚Äî **–≤—ñ–ª—å–Ω–µ –º—ñ—Å—Ü–µ**, **–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î —Ç—ñ–ª—å–∫–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –ø–∞–∫–µ—Ç–∏** (–ª–∏—à–µ —è–∫—â–æ —î —â–æ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏), –æ–Ω–æ–≤–ª—é—î **–ª–∏—à–µ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ CAP-–∏** —Ç–∞ **–æ—á–∏—â–∞—î** `.npk` –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ CAP-–∏ —ó—Ö –ø—ñ–¥—Ö–æ–ø–ª—è—Ç—å.

---

## üöÄ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- –í–∏–∑–Ω–∞—á–∞—î `latest-version` –≤—ñ–¥ update-—Å–µ—Ä–≤–µ—Ä–∞ (–∫–∞–Ω–∞–ª **–Ω–µ** –∑–º—ñ–Ω—é—î—Ç—å—Å—è).
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –≤–µ—Ä—Å—ñ—é **–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞** —ñ **–∫–æ–∂–Ω–æ–≥–æ CAP-–∞** (ac —ñ ax –æ–∫—Ä–µ–º–æ).
- –Ø–∫—â–æ **–≤—Å—ñ –Ω–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π –≤–µ—Ä—Å—ñ—ó** ‚Äî **–Ω—ñ—á–æ–≥–æ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î** —ñ –∑–∞–≤–µ—Ä—à—É—î —Ä–æ–±–æ—Ç—É.
- –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è:
  - –ü–µ—Ä–µ–≤—ñ—Ä—è—î **–≤—ñ–ª—å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä** –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ; —è–∫—â–æ –º–∞–ª–æ ‚Äî –∑—É–ø–∏–Ω—è—î—Ç—å—Å—è –∑ —á—ñ—Ç–∫–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º.
  - –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î **—Ä—ñ–≤–Ω–æ —Ç—ñ –ø–∞–∫–µ—Ç–∏**, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –ø—Ä–∏—Å—É—Ç–Ω—ñ—Ö –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä:
    - –ë–∞–∑–∞: `routeros-<ver>-arm.npk`, `routeros-<ver>-arm64.npk`
    - –î—Ä–∞–π–≤–µ—Ä–∏ Wi-Fi: `wifi-qcom-ac-<ver>-arm.npk` (ac), `wireless-<ver>-arm.npk` (legacy –¥–ª—è ac), `wifi-qcom-<ver>-arm64.npk` (ax)
    - –î–æ–¥–∞—Ç–∫–æ–≤–æ: `calea-<ver>-arm(.npk)` —ñ `-arm64` (–∑–∞–ø–æ–±—ñ–≥–∞—î –ø–æ–º–∏–ª—Ü—ñ *‚Äúno such file‚Äù*, —è–∫—â–æ CAP –º–∞—î CALEA)
- –û–Ω–æ–≤–ª—é—î **–ª–∏—à–µ –∑–∞—Å—Ç–∞—Ä—ñ–ª—ñ CAP-–∏** (–≤–æ–Ω–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Å–∞–º—ñ).
- –û–Ω–æ–≤–ª–µ–Ω–Ω—è **–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞** ‚Äî –∑–∞ –ø—Ä–∞–ø–æ—Ä—Ü–µ–º ¬´–±–µ–∑–ø–µ—á–Ω–∏–π —Ä–µ–±—É—Ç¬ª (–º–æ–∂–Ω–∞ –Ω–µ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ).
- –ü—ñ—Å–ª—è –ø–∞—É–∑–∏ –≤–∏–¥–∞–ª—è—î –≤—Å—ñ `.npk` –∑ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞.
- –õ–æ–≥–∏ **–∞–Ω–≥–ª—ñ–π—Å—å–∫–æ—é** —É —Ç–µ—Ä–º—ñ–Ω–∞–ª —Ç–∞ **System ‚Üí Log**.

---

## ‚úÖ –í–∏–º–æ–≥–∏

- RouterOS **7.16+** –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ (–ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –Ω–∞ 7.19.4).
- CAP-–∏ –≤–∏–¥–∏–º—ñ –ø—ñ–¥ `/caps-man` (ac) —Ç–∞/–∞–±–æ `/interface wifi capsman` (ax).
- –ù–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ –ø—Ä–∞—Ü—é—î **DNS/–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç**.
- –ü–æ–ª—ñ—Ç–∏–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞: **read, write, test, policy, ftp** (WinBox ‚Üí System ‚Üí Scripts ‚Üí –≤–∞—à —Å–∫—Ä–∏–ø—Ç ‚Üí Policies).

---

## üõ† –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è (–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ)

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ **WinBox / WebFig** ‚Üí **System ‚Üí Scripts ‚Üí +**.  
2. **Name**: `cap-bulk-upgrade`.  
3. –£–≤—ñ–º–∫–Ω—ñ—Ç—å Policies: **read, write, test, policy, ftp**.  
4. –í—Å—Ç–∞–≤—Ç–µ –∫–æ–¥ —Å–∫—Ä–∏–ø—Ç–∞ (caps-bulk-upgrade.rsc) ‚Üí **OK**.

---

## ‚ñ∂Ô∏è –ó–∞–ø—É—Å–∫ (–Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–º—É –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ)

- –ß–µ—Ä–µ–∑ WinBox: **System ‚Üí Scripts ‚Üí cap-bulk-upgrade ‚Üí Run Script**  

–ê–ë–û 

- –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º—ñ–Ω–∞–ª:
   ```rsc
   /system script run cap-bulk-upgrade
   ```

---

## ‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–Ω–∞ –ø–æ—á–∞—Ç–∫—É —Å–∫—Ä–∏–ø—Ç–∞)

- `:local safeControllerReboot true`  
  - `true` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º): **–Ω–µ** –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ; —Å–∫—Ä–∏–ø—Ç –≤–∏–≤–µ–¥–µ —Ç–æ—á–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, —è–∫—ñ –≤–∏–∫–æ–Ω–∞—Ç–∏ –≤—Ä—É—á–Ω—É.  
  - `false`: –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–∞–∑–æ–≤–∏–π –ø–∞–∫–µ—Ç RouterOS –¥–ª—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —Ç–∞ **–ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç—å** –π–æ–≥–æ –æ–¥—Ä–∞–∑—É; –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∏–π scheduler –∑—Ä–æ–±–∏—Ç—å –ø—Ä–∏–±–∏—Ä–∞–Ω–Ω—è –ø—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É.

- `:local minFreePerPkgBytes 15000000` ‚Äî –æ—Ü—ñ–Ω–∫–∞ –ø–æ—Ç—Ä—ñ–±–Ω–æ–≥–æ –º—ñ—Å—Ü—è (‚âà15 –ú—ñ–ë –Ω–∞ –ø–∞–∫–µ—Ç, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫—É –ø–µ—Ä–µ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º).

- `:local cleanupDelay "120s"` ‚Äî —á–∞—Å –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤ CAP-–∞–º–∏ –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º `.npk`.


## üß∞ –£—Å—É–Ω–µ–Ω–Ω—è –Ω–µ—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

- **‚Äúcannot detect latest-version‚Äù** ‚Üí –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ DNS/–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ñ:
   ```rsc
   /ping 8.8.8.8 count=3
   /ip dns print
   ```
- **‚Äúinsufficient space ‚Ä¶‚Äù** ‚Üí –∑–≤—ñ–ª—å–Ω—ñ—Ç—å –º—ñ—Å—Ü–µ —É **Files** (–≤–∏–¥–∞–ª—ñ—Ç—å –∑–∞–π–≤–µ), –ø–æ–≤—Ç–æ—Ä—ñ—Ç—å –∑–∞–ø—É—Å–∫.
- **–ù–∞ CAP –ø–æ–º–∏–ª–∫–∞ ‚Äúfailed to download ‚Ä¶ .npk, no such file‚Äù** ‚Üí –Ω–∞ CAP –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –ø–∞–∫–µ—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `calea`). –î–æ–¥–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π `.npk` –¥–ª—è –π–æ–≥–æ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ (`-arm` –∞–±–æ `-arm64`) —É **Files** –∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä–∞ —Ç–∞ –ø–æ–≤—Ç–æ—Ä—ñ—Ç—å.